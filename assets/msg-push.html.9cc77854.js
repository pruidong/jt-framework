import{r as t,o as e,c as o,a as n,b as p,F as c,e as s,d as l}from"./app.2cf53764.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const i={},r=n("h1",{id:"\u6D88\u606F\u4E0B\u53D1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u6D88\u606F\u4E0B\u53D1","aria-hidden":"true"},"#"),s(" \u6D88\u606F\u4E0B\u53D1")],-1),k={class:"custom-container tip"},m=n("p",{class:"custom-container-title"},"\u4F20\u9001\u95E8",-1),b=s("\u672C\u5C0F\u8282\u7684\u793A\u4F8B\u53EF\u4EE5\u5728 "),d={href:"https://github.com/hylexus/jt-framework/tree/master/samples/jt-808-server-sample-annotation",target:"_blank",rel:"noopener noreferrer"},g=s("samples/jt-808-server-sample-annotation"),h=s(" \u4E0B\u627E\u5230\u5BF9\u5E94\u4EE3\u7801\u3002"),f=l(`<div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><p>\u672C\u5C0F\u8282\u5C06\u4ECB\u7ECD\u5982\u4F55\u4E3B\u52A8\u4E0B\u53D1\u6D88\u606F\u7ED9\u7EC8\u7AEF\u3002</p></div><h2 id="_1-\u624B\u52A8\u4E0B\u53D1" tabindex="-1"><a class="header-anchor" href="#_1-\u624B\u52A8\u4E0B\u53D1" aria-hidden="true">#</a> 1. \u624B\u52A8\u4E0B\u53D1</h2><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SomeController</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Jt808SessionManager</span> sessionManager<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendDataToClient</span><span class="token punctuation">(</span><span class="token class-name">String</span> terminalId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u901A\u8FC7\u7EC8\u7AEFid\u83B7\u53D6Session</span>
        <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Jt808Session</span><span class="token punctuation">&gt;</span></span> sessionInfo <span class="token operator">=</span> sessionManager<span class="token punctuation">.</span><span class="token function">findByTerminalId</span><span class="token punctuation">(</span>terminalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sessionInfo<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">JtSessionNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;session not found with terminalId &quot;</span> <span class="token operator">+</span> terminalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u901A\u8FC7Session\u53D1\u9001\u6570\u636E</span>
            sessionInfo<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMsgToClient</span><span class="token punctuation">(</span><span class="token class-name">Unpooled</span><span class="token punctuation">.</span><span class="token function">copiedBuffer</span><span class="token punctuation">(</span><span class="token string">&quot;data will be sent to client&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="custom-container danger"><p class="custom-container-title">\u8B66\u544A</p><ul><li>\u624B\u52A8\u53D1\u9001\u7684\u6570\u636E\uFF0C\u9700\u8981\u624B\u52A8\u62FC\u88C5\u4E3A\u7B26\u5408808\u534F\u8BAE\u683C\u5F0F\u7684\u62A5\u6587\uFF0C\u5E76\u624B\u52A8\u8F6C\u4E49\u3002</li><li>\u6240\u4EE5\u5185\u7F6E\u4E86\u4E00\u4E2ACommandSender\u6765\u81EA\u52A8\u8F6C\u6362\u4E3A\u7B26\u5408808\u534F\u8BAE\u683C\u5F0F\u7684\u62A5\u6587\u5E76\u53D1\u9001\u7ED9\u5BA2\u6237\u7AEF\u3002</li></ul></div><h2 id="_2-\u4F7F\u7528commandsender\u4E0B\u53D1" tabindex="-1"><a class="header-anchor" href="#_2-\u4F7F\u7528commandsender\u4E0B\u53D1" aria-hidden="true">#</a> 2. \u4F7F\u7528CommandSender\u4E0B\u53D1</h2><h3 id="\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> \u5B9E\u73B0\u539F\u7406</h3><p>TODO \u8FD9\u91CC\u7F3A\u4E00\u4E2A\u56FE\uFF0C\u6682\u65F6\u6CA1\u65F6\u95F4\u753B\u4E86\u2026\u2026\u2026\u2026</p><h3 id="\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B" aria-hidden="true">#</a> \u793A\u4F8B</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/demo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CommandSender</span> commandSender<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/send-msg&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;terminalId&quot;</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">&quot;13717861955&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> terminalId<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">&quot;timeout&quot;</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> timeout<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token class-name">RespTerminalSettings</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RespTerminalSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RespTerminalSettings<span class="token punctuation">.</span>ParamItem</span><span class="token punctuation">&gt;</span></span> paramList <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">RespTerminalSettings<span class="token punctuation">.</span>ParamItem</span><span class="token punctuation">(</span><span class="token number">0x0029</span><span class="token punctuation">,</span> <span class="token class-name">DwordBytesValueWrapper</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        param<span class="token punctuation">.</span><span class="token function">setParamList</span><span class="token punctuation">(</span>paramList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        param<span class="token punctuation">.</span><span class="token function">setTotalParamCount</span><span class="token punctuation">(</span>paramList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u3010\u4E0B\u53D1\u6D88\u606F\u3011\u7684\u6D88\u606F\u7C7B\u578B\u4E3A: RESP_TERMINAL_PARAM_SETTINGS (0x8103)  --&gt; RespTerminalSettings\u7684\u7C7B\u6CE8\u89E3\u4E0A\u6307\u5B9A\u4E86\u4E0B\u53D1\u7C7B\u578B</span>
        <span class="token comment">// \u5BA2\u6237\u7AEF\u5BF9\u8BE5\u3010\u4E0B\u53D1\u6D88\u606F\u3011\u7684\u56DE\u590D\u6D88\u606F\u7C7B\u578B\u4E3A: CLIENT_COMMON_REPLY (0x0001)</span>
        <span class="token class-name">CommandMsg</span> commandMsg <span class="token operator">=</span> <span class="token class-name">CommandMsg</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>terminalId<span class="token punctuation">,</span> CLIENT_COMMON_REPLY<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span> resp <span class="token operator">=</span> commandSender<span class="token punctuation">.</span><span class="token function">sendCommandAndWaitingForReply</span><span class="token punctuation">(</span>commandMsg<span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;resp: {}&quot;</span><span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Jt808RespMsgBody</span><span class="token punctuation">(</span>respMsgId <span class="token operator">=</span> <span class="token number">0x8103</span><span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">&quot;\u8BBE\u7F6E\u7EC8\u7AEF\u53C2\u6570&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RespTerminalSettings</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@CommandField</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ParamItem</span><span class="token punctuation">&gt;</span></span> paramList<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@CommandField</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> targetMsgDataType <span class="token operator">=</span> BYTE<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> totalParamCount<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ParamItem</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@CommandField</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> targetMsgDataType <span class="token operator">=</span> DWORD<span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> msgId<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@CommandField</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> targetMsgDataType <span class="token operator">=</span> BYTE<span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> bytesCountOfContentLength<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@CommandField</span><span class="token punctuation">(</span>order <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">BytesValueWrapper</span> msgContent<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">ParamItem</span><span class="token punctuation">(</span><span class="token keyword">int</span> msgId<span class="token punctuation">,</span> <span class="token class-name">BytesValueWrapper</span> msgContent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msgId <span class="token operator">=</span> msgId<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msgContent <span class="token operator">=</span> msgContent<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>bytesCountOfContentLength <span class="token operator">=</span> msgContent<span class="token punctuation">.</span><span class="token function">getAsBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div>`,10),y={class:"custom-container tip"},_=n("p",{class:"custom-container-title"},"\u4F20\u9001\u95E8",-1),w=s("\u672C\u5C0F\u8282\u7684\u793A\u4F8B\u53EF\u4EE5\u5728 "),v={href:"https://github.com/hylexus/jt-framework/tree/master/samples/jt-808-server-sample-annotation",target:"_blank",rel:"noopener noreferrer"},C=s("samples/jt-808-server-sample-annotation"),S=s(" \u4E0B\u627E\u5230\u5BF9\u5E94\u4EE3\u7801\u3002");function I(q,x){const a=t("ExternalLinkIcon");return e(),o(c,null,[r,n("div",k,[m,n("p",null,[b,n("a",d,[g,p(a)]),h])]),f,n("div",y,[_,n("p",null,[w,n("a",v,[C,p(a)]),S])])],64)}var j=u(i,[["render",I]]);export{j as default};
